AppRunnerService:
  Type: AWS::AppRunner::Service
  Properties:
    ServiceName: DataVisualiserProd-AppRunnerService
    InstanceConfiguration:
      InstanceRoleArn: !GetAtt AppRunnerInstanceRole.Arn
    NetworkConfiguration:
      EgressConfiguration:
        EgressType: VPC
        VpcConnectorArn: !Ref AppRunnerVpcConnector
      IngressConfiguration:
        IsPubliclyAccessible: true
    SourceConfiguration:
      AuthenticationConfiguration:
        AccessRoleArn: !GetAtt AppRunnerEcrAccessRole.Arn
      AutoDeploymentsEnabled: true
      ImageRepository:
        ImageIdentifier: !Sub "${AWS::AccountId}.dkr.ecr.${AWS::Region}.amazonaws.com/${FullRepositoryId}:latest"
        ImageRepositoryType: ECR
      ImageConfiguration:
        Port: 8080
        RuntimeEnvironmentVariables:
          - Name: PORT
            Value: '8080'
          - Name: AWS_REGION
            Value: !Ref AWS::Region
        RuntimeEnvironmentSecrets:
          - Name: RDS_CREDS_JSON
            Value: "arn:aws:secretsmanager:eu-west-1:507038060985:secret:DataVisualizer/RdsCredentials-2Twah"
          - Name: SECRET_KEY
            Value: "arn:aws:secretsmanager:eu-west-1:507038060985:secret:DataVisualizer/Secret-Prod-nelNEq"